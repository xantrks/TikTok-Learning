<script type="importmap">
  {
    "imports": {
      "@google/genai": "https://esm.sh/@google/genai@^0.7.0",
      "marked": "https://esm.sh/marked@^15.0.7"
    }
  }
</script>

<!-- API Key Setup Modal -->
<div id="api-key-modal" class="api-key-modal" hidden>
  <div class="api-key-modal-content">
    <div class="api-key-header">
      <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path>
      </svg>
      <h2>Welcome to TikTok Learning!</h2>
      <p>To get started, you'll need to provide your Gemini API key.</p>
    </div>
    
    <div class="api-key-form">
      <label for="api-key-input">Gemini API Key:</label>
      <input type="password" id="api-key-input" placeholder="Enter your Gemini API key..." />
      <div class="api-key-help">
        <p>Don't have an API key? <a href="https://aistudio.google.com/app/apikey" target="_blank">Get one from Google AI Studio</a></p>
        <p class="help-text">Your API key is stored locally and never shared.</p>
      </div>
      <div class="api-key-actions">
        <button id="save-api-key" class="primary-btn">Save & Continue</button>
      </div>
    </div>
  </div>
</div>

<div class="tiktok-container">
  <header>
    <div class="logo">
      <h1>TIKTOK</h1><span class="logo-subtitle">Learning</span>
    </div>
    <div class="search-bar">
      <input type="text" placeholder="Search" />
      <button>
        <svg width="24" height="24" viewBox="0 0 24 24" fill="rgba(255, 255, 255, 0.34)"><path d="m10.51 18.22-.33-.3-.04-.04c1.8-2.1 2.86-4.8 2.86-7.88C13 4.01 9.99 1 6.5 1S0 4.01 0 7.5c0 3.49 3.01 6.5 6.5 6.5 2.88 0 5.42-1.8 6.47-4.32l.33.3.04.04 4.8 4.8c.55.55 1.44.55 1.99 0s.55-1.44 0-1.99l-4.8-4.8Zm-4.01-1.72c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4Z"></path></svg>
      </button>
    </div>
    <div class="header-actions">
      <button id="theme-toggle" class="action-btn" aria-label="Toggle theme">
        <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
        <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
      </button>
    </div>
  </header>
  <main class="main-content">
    <aside class="sidebar left-sidebar">
      <h2>Creator Tools</h2>
      <p>1. Choose your storyteller:</p>
      <select id="character-selector">
        <option value="cat">ğŸ± Cat</option>
        <option value="dog">ğŸ¶ Dog</option>
        <option value="spiderman">ğŸ•·ï¸ Spider-Man</option>
        <option value="doraemon">ğŸ¤– Doraemon</option>
        <option value="barbie">ğŸ’– Barbie</option>
        <option value="simba">ğŸ¦ Simba</option>
        <option value="ironman">ğŸ¤– Iron Man</option>
        <option value="steve">ğŸ§± Steve (Minecraft)</option>
      </select>
      <p>Choose storyteller voice:</p>
      <select id="voice-selector"></select>
      <p>2. Pick an example:</p>
      <select id="examples-selector">
        <option value="" disabled selected>Select an example...</option>
        <option value="Explain how rain forms?">Explain how rain forms?</option>
        <option value="Explain why sky is blue?">Explain why sky is blue?</option>
        <option value="Explain how the internet works?">Explain how the internet works?</option>
        <option value="Explain how stars are formed.">Explain how stars are formed.</option>
        <option value="Explain why we have day and night.">Explain why we have day and night.</option>
        <option value="Explain how seeds turn into plants.">Explain how seeds turn into plants.</option>
        <option value="Explain how airplanes fly.">Explain how airplanes fly.</option>
      </select>
      <p>3. Or ask your own question:</p>
      <div id="error" hidden></div>
      <textarea id="input" placeholder="Enter a question."></textarea>
      <button id="generate-btn">Generate TikTok</button>
    </aside>
    <div class="feed-container">
       <div id="slideshow" hidden></div>
       <div id="initial-message">
         <div class="initial-content">
           <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-film"><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect><line x1="7" y1="2" x2="7" y2="22"></line><line x1="17" y1="2" x2="17" y2="22"></line><line x1="2" y1="12" x2="22" y2="12"></line><line x1="2" y1="7" x2="7" y2="7"></line><line x1="2" y1="17" x2="7" y2="17"></line><line x1="17" y1="17" x2="22" y2="17"></line><line x1="17" y1="7" x2="22" y2="7"></line></svg>
           <h2>Your TikTok Appears Here</h2>
           <p>Use the creator tools on the left to generate a new TikTok.</p>
         </div>
       </div>
    </div>
    <aside class="sidebar right-sidebar">
       <h2>My TikToks</h2>
       <div id="history-gallery">
         <p class="gallery-placeholder">Saved TikToks will appear here.</p>
       </div>
    </aside>
  </main>
</div>
<audio id="background-music" src="https://pixabay.com/music/download/audio-323851.mp3" loop></audio>